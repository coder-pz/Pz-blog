<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue源码 | Pz&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/Pz-blog/images/head_photo.jpg">
    <meta name="description" content="Pz&#39;s blog">
    
    <link rel="preload" href="/Pz-blog/assets/css/0.styles.016f71d4.css" as="style"><link rel="preload" href="/Pz-blog/assets/js/app.eed66c3b.js" as="script"><link rel="preload" href="/Pz-blog/assets/js/2.652b4c3a.js" as="script"><link rel="preload" href="/Pz-blog/assets/js/3.b1d40e3b.js" as="script"><link rel="prefetch" href="/Pz-blog/assets/js/10.0704076a.js"><link rel="prefetch" href="/Pz-blog/assets/js/11.229f9fa5.js"><link rel="prefetch" href="/Pz-blog/assets/js/12.15108922.js"><link rel="prefetch" href="/Pz-blog/assets/js/13.b6134e3f.js"><link rel="prefetch" href="/Pz-blog/assets/js/14.fe24455c.js"><link rel="prefetch" href="/Pz-blog/assets/js/15.7df61f2e.js"><link rel="prefetch" href="/Pz-blog/assets/js/16.ac409815.js"><link rel="prefetch" href="/Pz-blog/assets/js/17.03da3341.js"><link rel="prefetch" href="/Pz-blog/assets/js/18.e1cf12f5.js"><link rel="prefetch" href="/Pz-blog/assets/js/19.dec66d2b.js"><link rel="prefetch" href="/Pz-blog/assets/js/4.a8bf158c.js"><link rel="prefetch" href="/Pz-blog/assets/js/5.a36cd7d2.js"><link rel="prefetch" href="/Pz-blog/assets/js/6.86544046.js"><link rel="prefetch" href="/Pz-blog/assets/js/7.44c0b9d1.js"><link rel="prefetch" href="/Pz-blog/assets/js/8.86da811b.js"><link rel="prefetch" href="/Pz-blog/assets/js/9.21cbf9ca.js">
    <link rel="stylesheet" href="/Pz-blog/assets/css/0.styles.016f71d4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Pz-blog/" class="home-link router-link-active"><!----> <span class="site-name">Pz's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          布局
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/布局/flex布局.html" class="nav-link">
  flex布局
</a></li><li class="dropdown-subitem"><a href="/Pz-blog/notebook/布局/Grid布局.html" class="nav-link">
  Grid布局
</a></li></ul></li><li class="dropdown-item"><h4>
          javaScript
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/js/js笔记.html" class="nav-link">
  js常用
</a></li><li class="dropdown-subitem"><a href="/Pz-blog/notebook/js/数组操作.html" class="nav-link">
  数组操作
</a></li></ul></li><li class="dropdown-item"><h4>
          构建工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/构建/webpack.html" class="nav-link">
  webpack
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端框架" class="dropdown-title"><span class="title">前端框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端框架" class="mobile-dropdown-title"><span class="title">前端框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Vue2
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/前端框架/Vue2/Vue属性.html" class="nav-link">
  Vue属性
</a></li><li class="dropdown-subitem"><a href="/Pz-blog/notebook/前端框架/Vue2/Vue指令.html" class="nav-link">
  Vue指令
</a></li><li class="dropdown-subitem"><a href="/Pz-blog/notebook/前端框架/Vue2/Vue组件化.html" class="nav-link">
  Vue指令
</a></li><li class="dropdown-subitem"><a href="/Pz-blog/notebook/前端框架/Vue2/Vue-router.html" class="nav-link">
  VueRouter
</a></li></ul></li><li class="dropdown-item"><h4>
          Vue3
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/前端框架/Vue3/Vue3.html" class="nav-link">
  Vue3基本使用
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码管理" class="dropdown-title"><span class="title">代码管理</span> <span class="arrow down"></span></button> <button type="button" aria-label="代码管理" class="mobile-dropdown-title"><span class="title">代码管理</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Pz-blog/notebook/git/Git.html" class="nav-link">
  git
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/liupziio/Pz-blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          布局
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/布局/flex布局.html" class="nav-link">
  flex布局
</a></li><li class="dropdown-subitem"><a href="/Pz-blog/notebook/布局/Grid布局.html" class="nav-link">
  Grid布局
</a></li></ul></li><li class="dropdown-item"><h4>
          javaScript
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/js/js笔记.html" class="nav-link">
  js常用
</a></li><li class="dropdown-subitem"><a href="/Pz-blog/notebook/js/数组操作.html" class="nav-link">
  数组操作
</a></li></ul></li><li class="dropdown-item"><h4>
          构建工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/构建/webpack.html" class="nav-link">
  webpack
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端框架" class="dropdown-title"><span class="title">前端框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端框架" class="mobile-dropdown-title"><span class="title">前端框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Vue2
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/前端框架/Vue2/Vue属性.html" class="nav-link">
  Vue属性
</a></li><li class="dropdown-subitem"><a href="/Pz-blog/notebook/前端框架/Vue2/Vue指令.html" class="nav-link">
  Vue指令
</a></li><li class="dropdown-subitem"><a href="/Pz-blog/notebook/前端框架/Vue2/Vue组件化.html" class="nav-link">
  Vue指令
</a></li><li class="dropdown-subitem"><a href="/Pz-blog/notebook/前端框架/Vue2/Vue-router.html" class="nav-link">
  VueRouter
</a></li></ul></li><li class="dropdown-item"><h4>
          Vue3
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/前端框架/Vue3/Vue3.html" class="nav-link">
  Vue3基本使用
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码管理" class="dropdown-title"><span class="title">代码管理</span> <span class="arrow down"></span></button> <button type="button" aria-label="代码管理" class="mobile-dropdown-title"><span class="title">代码管理</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Pz-blog/notebook/git/Git.html" class="nav-link">
  git
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/liupziio/Pz-blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  My Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>vue源码</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_1、三大核心系统" class="sidebar-link">1、三大核心系统</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_1、异步组件" class="sidebar-link">1、异步组件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_2、suspense插槽-处理组件不显示" class="sidebar-link">2、Suspense插槽 处理组件不显示</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_3、组件之间的v-model" class="sidebar-link">3、组件之间的v-model</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_1、函数式-setup" class="sidebar-link">1、函数式 setup</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_2、script-setup" class="sidebar-link">2、script setup</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_3、两者差异" class="sidebar-link">3、两者差异</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_1、customref-自定义ref" class="sidebar-link">1、customRef（自定义ref）</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_2、computed使用" class="sidebar-link">2、computed使用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_3、watch的使用" class="sidebar-link">3、watch的使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#两种监听模式" class="sidebar-link">两种监听模式</a></li></ul></li><li><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_4、在setup中使用ref" class="sidebar-link">4、在setup中使用ref</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_5、render函数与h函数" class="sidebar-link">5、render函数与h函数</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_6、directives-自定义指令" class="sidebar-link">6、directives(自定义指令)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_1-基本使用" class="sidebar-link">1. 基本使用</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_2-指令的生命周期" class="sidebar-link">2. 指令的生命周期</a></li></ul></li><li><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_7、teleport-template插入到指定容器中" class="sidebar-link">7、teleport（template插入到指定容器中）</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_8、全局注册插件-app-use" class="sidebar-link">8、全局注册插件(app.use())</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_1、基本使用" class="sidebar-link">1、基本使用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_1、state" class="sidebar-link">1、state</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_2、getters" class="sidebar-link">2、getters</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_1、类型" class="sidebar-link">1、类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_1-1-ref-获取组件-instancetype" class="sidebar-link">1.1 ref () 获取组件   InstanceType</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_1-2-使用-vuex-usestore" class="sidebar-link">1.2 使用 Vuex useStore *</a></li></ul></li><li><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_2、router" class="sidebar-link">2、router</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_2-1-动态路由创建文件" class="sidebar-link">2.1 动态路由创建文件</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_2-2-require-context-加载文件使用" class="sidebar-link">2.2 require.context 加载文件使用</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_2-3-实现动态路由" class="sidebar-link">2.3 实现动态路由</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_2-4-路由注册执行顺序" class="sidebar-link">2.4 路由注册执行顺序</a></li></ul></li><li><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_3、组件中的双向绑定" class="sidebar-link">3、组件中的双向绑定</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/Vue3/Vue3.html#_3-1-方式" class="sidebar-link">3.1 方式</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue源码"><a href="#vue源码" class="header-anchor">#</a> vue源码</h1> <h2 id="_1、三大核心系统"><a href="#_1、三大核心系统" class="header-anchor">#</a> 1、三大核心系统</h2> <ul><li><strong>Compiler模块</strong> : 编译模板系统</li> <li><strong>Runtime模块</strong>：也可以称之为Renderer模块，真正的渲染模块；</li> <li><strong>Reactivity模块</strong>：响应式系统</li></ul> <h1 id="一、组件"><a href="#一、组件" class="header-anchor">#</a> 一、组件</h1> <h2 id="_1、异步组件"><a href="#_1、异步组件" class="header-anchor">#</a> 1、异步组件</h2> <p><strong>defineAsyncComponent vue异步组件API</strong></p> <p><strong>问：</strong>  异步组件的应用场景与作用 ？</p> <p><strong>答：</strong></p> <ul><li>异步组件可以让 Vue 第一次渲染时更加快一点</li> <li>对于Webpack 来说 项目打包时，会将这个异步组件打包成一个单独的 js  当使用到时，再去加载这个 js 文件。</li></ul> <p><strong>使用方法</strong></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    App组件
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AsyncCategory</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>AsyncCategory</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineAsyncComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Loading <span class="token keyword">from</span> <span class="token string">&quot;./loading.vue&quot;</span>
<span class="token comment">// 工厂函数</span>
<span class="token comment">// const AsyncCategory = defineAsyncComponent(() =&gt; import(&quot;./AsnycCategory.vue&quot;));//简写</span>
   
<span class="token comment">//对象方式</span>
<span class="token keyword">const</span> AsyncCategory <span class="token operator">=</span> <span class="token function">defineAsyncComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">loader</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./AsnycCategory.vue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">loadingComponent</span><span class="token operator">:</span>Loading<span class="token punctuation">,</span><span class="token comment">//没有加载出来站位</span>
    <span class="token comment">// errorComponent:'',//组件加载失败显示的组件</span>
    <span class="token literal-property property">delay</span><span class="token operator">:</span><span class="token number">2000</span><span class="token punctuation">,</span><span class="token comment">//在显示loading组件之前,等待多长时间(延迟显示)</span>
   <span class="token comment">/**
   *
   * @param {*} error 错误信息对象
   * @param {*} retry 一个函数，用于指示当 promise 加载器 reject 时，加载器是否应该重试
   * @param {*} fail  一个函数，指示加载程序结束退出
   * @param {*} attempts 允许的最大重试次数
   */</span>
   <span class="token function-variable function">onError</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> retry<span class="token punctuation">,</span> fail<span class="token punctuation">,</span> attempts</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">fetch</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> attempts <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 请求发生错误时重试，最多可尝试 3 次</span>
      <span class="token function">retry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 注意，retry/fail 就像 promise 的 resolve/reject 一样：</span>
      <span class="token comment">// 必须调用其中一个才能继续错误处理。</span>
      <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    AsyncCategory<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="_2、suspense插槽-处理组件不显示"><a href="#_2、suspense插槽-处理组件不显示" class="header-anchor">#</a> 2、Suspense插槽 处理组件不显示</h2> <p><strong>Suspense vue试验性API 随时修改</strong></p> <p>**问：**Suspense 的应用场景与作用 ？</p> <p><strong>答：</strong></p> <ul><li>可以处理组件如果没有加载出来去显示另一个</li></ul> <p><strong>使用方法 (异步组件为例)</strong></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>suspense</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">#default</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- 默认显示 --&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>todo-list</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">#fallback</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- 没有加载到,显示 --&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        Loading.... <span class="token comment">&lt;!-- 这里也可以放组件 --&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>suspense</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
   <span class="token keyword">import</span> <span class="token punctuation">{</span> defineAsyncComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span><span class="token comment">//异步组件API</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">TodoList</span><span class="token operator">:</span> <span class="token function">defineAsyncComponent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./TodoList.vue'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><h2 id="_3、组件之间的v-model"><a href="#_3、组件之间的v-model" class="header-anchor">#</a> 3、组件之间的v-model</h2> <p>**问：**组件之间的v-model 的应用场景与作用 ？</p> <p><strong>答：</strong></p> <ul><li>应用场景多了去了 , 作用大了去了 , 封装个组件不要双向绑定嘛, <strong>擦</strong></li></ul> <p><strong>使用方法 ( 利用v-model标签上隐性绑定的update:name方法 )</strong></p> <ul><li><strong>父组件</strong></li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ message }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hy-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">v-model:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hy-input</span><span class="token punctuation">&gt;</span></span>
          <span class="token comment">&lt;!-- 这里默认会绑定 update:modelValue update:title 两个事件等同于下边的举例--&gt;</span>
     <span class="token comment">&lt;!--    &lt;hy-input v-model=&quot;message&quot; v-model:title=&quot;title&quot; @update:modelValue=&quot;message=$event&quot; @update:title=&quot;title=$event&quot;&gt;&lt;/hy-input&gt; --&gt;</span>
      

     
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> HyInput <span class="token keyword">from</span> <span class="token string">&quot;./HyInput.vue&quot;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">components</span><span class="token operator">:</span><span class="token punctuation">{</span>
        HyInput
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;lpz&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">'哈哈哈'</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>


</code></pre></div><ul><li><strong>子组件</strong></li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code>#子组件
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>我是传进来的：{{ modelValue }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">modelValue</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">emits</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;update:modelValue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;update:title&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//注册自定义事件</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//利用computed显示(get)与调用自定义事件(set)</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;update:modelValue&quot;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modelValue<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">title1</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;update:title&quot;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h1 id="二、两种setup使用"><a href="#二、两种setup使用" class="header-anchor">#</a> 二、两种setup使用</h1> <h2 id="_1、函数式-setup"><a href="#_1、函数式-setup" class="header-anchor">#</a> 1、函数式 setup</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> watch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/store'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> usePermission <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/hooks/use-permission'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> HyTable <span class="token keyword">from</span> <span class="token string">'@/base-ui/table'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">//定义组件</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    HyTable
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//props使用</span>
    <span class="token literal-property property">contentTableConfig</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
      <span class="token literal-property property">require</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">pageName</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">emits</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'newBtnClick'</span><span class="token punctuation">,</span> <span class="token string">'editBtnClick'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//emits事件</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> <span class="token punctuation">{</span> emit <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//在这里拿到props与emit</span>
    <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      store
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h2 id="_2、script-setup"><a href="#_2、script-setup" class="header-anchor">#</a> 2、script setup</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span> setup<span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span>defineProps<span class="token punctuation">,</span> withDefaults<span class="token punctuation">,</span><span class="token comment">/*设置props默认值*/</span> watchEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> EChartsOption <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'echarts'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> useEchart <span class="token keyword">from</span> <span class="token string">'../hooks/useEchart'</span><span class="token punctuation">;</span>
<span class="token comment">//withDefaults 第一个参数为props 第二个为props中的默认值 并且会返回出来一个props可以使用返回值获取props中的值</span>
<span class="token comment">// defineProps 定于propsdefineProps&lt;{}&gt;()</span>
<span class="token comment">// 定义props</span>
<span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token function">withDefaults</span><span class="token punctuation">(</span>
  defineProps<span class="token operator">&lt;</span><span class="token punctuation">{</span>
    <span class="token literal-property property">options</span><span class="token operator">:</span> EChartsOption<span class="token punctuation">;</span>
    width<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span><span class="token comment">//设置是否必传(?)</span>
    height<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">'100%'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">'360px'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> echartDivRef <span class="token operator">=</span> ref<span class="token operator">&lt;</span>HTMLElement<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> setOptions <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useEchart</span><span class="token punctuation">(</span>echartDivRef<span class="token punctuation">.</span>value<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setOptions</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h2 id="_3、两者差异"><a href="#_3、两者差异" class="header-anchor">#</a> 3、两者差异</h2> <h1 id="三、基础api"><a href="#三、基础api" class="header-anchor">#</a> 三、基础Api</h1> <h2 id="_1、customref-自定义ref"><a href="#_1、customref-自定义ref" class="header-anchor">#</a> 1、customRef（自定义ref）</h2> <ul><li>自定义ref防抖事件</li></ul> <p><strong>customRef 有两个参数，并且返回一个对象，对象中必须有set与get函数</strong></p> <ul><li>track 搜集依赖</li> <li>trigger 触发更新</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> customRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 自定义ref</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token comment">// track 搜集依赖</span>
  <span class="token comment">// trigger 触发更新</span>
  <span class="token keyword">return</span> <span class="token function">customRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">track<span class="token punctuation">,</span> trigger</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">track</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//延迟一秒更新数据</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          value <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
          <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//使用</span>
<span class="token keyword">import</span> debounceRef <span class="token keyword">from</span> <span class="token string">&quot;./hook/useDebounceRef.js&quot;</span>
<span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token function">debounceRef</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      message<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="_2、computed使用"><a href="#_2、computed使用" class="header-anchor">#</a> 2、computed使用</h2> <p><strong>computed本身返回的是一个ref对象</strong></p> <ul><li>实例</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> fullName <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;changeName&quot;</span><span class="token operator">&gt;</span>修改firstName<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fristName <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;Kobe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> lastName <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;Bryant&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//1.直接返回值</span>
    <span class="token comment">// const fullName = computed(() =&gt; fristName.value + &quot; &quot; + lastName.value);</span>
    <span class="token comment">//2.传入对象设置set，get</span>
    <span class="token keyword">const</span> fullName <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> fristName<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> lastName<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      <span class="token function">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> names <span class="token operator">=</span> newValue<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fristName<span class="token punctuation">.</span>value <span class="token operator">=</span> names<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        lastName<span class="token punctuation">.</span>value <span class="token operator">=</span> names<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token function-variable function">changeName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//   fristName.value = &quot;James&quot;;</span>
      fullName<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&quot;code why&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      fullName<span class="token punctuation">,</span>
      changeName<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="_3、watch的使用"><a href="#_3、watch的使用" class="header-anchor">#</a> 3、watch的使用</h2> <h3 id="两种监听模式"><a href="#两种监听模式" class="header-anchor">#</a> 两种监听模式</h3> <h4 id="_1-watcheffect-自动搜集响应式依赖"><a href="#_1-watcheffect-自动搜集响应式依赖" class="header-anchor">#</a> 1. watchEffect 自动搜集响应式依赖</h4> <p><strong>弊端：</strong></p> <p>第一次一定会执行，因为会去查找内部有些哪些需要监听的值</p> <ul><li>当前函数会在最开始立即执行一次，并且在立即执行的同时会去查找函数内使用了哪些值，并监听他们</li></ul> <p><strong>使用:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>name<span class="token operator">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>age<span class="token operator">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> age <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;changeName&quot;</span><span class="token operator">&gt;</span>nameChange<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;changeAge&quot;</span><span class="token operator">&gt;</span>AgeChange<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>


<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> watchEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;why&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">changeName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&quot;kobe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">changeAge</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> age<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
        <span class="token string">&quot;watchEffect-changeName&quot;</span><span class="token punctuation">,</span>
        name<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        <span class="token string">&quot;watchEffect-changeAge&quot;</span><span class="token punctuation">,</span>
        age<span class="token punctuation">.</span>value
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      name<span class="token punctuation">,</span>
      age<span class="token punctuation">,</span>
      changeName<span class="token punctuation">,</span>
      changeAge<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="watcheffect-的停止侦听"><a href="#watcheffect-的停止侦听" class="header-anchor">#</a> watchEffect 的停止侦听</h5> <ul><li>watchEffect 返回的是一个函数,调用即可停止监听</li></ul> <p><strong>使用：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">const</span> shop <span class="token operator">=</span>   <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
        <span class="token string">&quot;watchEffect-changeName&quot;</span><span class="token punctuation">,</span>
        name<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        <span class="token string">&quot;watchEffect-changeAge&quot;</span><span class="token punctuation">,</span>
        age<span class="token punctuation">.</span>value
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">const</span> <span class="token function-variable function">changeAge</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       age<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span>age<span class="token punctuation">.</span>value<span class="token operator">&gt;</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token function">shop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
</code></pre></div><h5 id="清除watcheffect副作用"><a href="#清除watcheffect副作用" class="header-anchor">#</a> 清除watchEffect副作用</h5> <p><strong>什么是副作用：</strong></p> <p>例：监听一个值的变化来发送网络请求，多次变化上一次数据没有回来就发送了第二个请求，这个过程就叫 <code>watchEffect副作用</code></p> <p><strong>使用：</strong></p> <ol><li>可以用wacthEffect返回值清空所有</li> <li>也可以根据情况自己封装</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">const</span> shop <span class="token operator">=</span> <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">test</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 根据name和age两个变量发送网络请求</span>
      <span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;模拟网络请求&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
         <span class="token comment">//只要是组件销毁便会执行</span>
        <span class="token comment">// 在这里清楚无用的副作用</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
        <span class="token string">&quot;watchEffect-changeName&quot;</span><span class="token punctuation">,</span>
        name<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        <span class="token string">&quot;watchEffect-changeAge&quot;</span><span class="token punctuation">,</span>
        age<span class="token punctuation">.</span>value
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">changeAge</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      age<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>age<span class="token punctuation">.</span>value <span class="token operator">&gt;</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">shop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="watcheffect-第二个参数"><a href="#watcheffect-第二个参数" class="header-anchor">#</a> watchEffect 第二个参数</h5> <ul><li>第二个参数是来控制 watchEffect 的立即监听</li></ul> <p><strong>例子：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
      <span class="token literal-property property">flush</span><span class="token operator">:</span><span class="token string">&quot;post&quot;</span>
      <span class="token comment">// flush:'post'</span>

      <span class="token comment">// // flush:&quot;sync&quot;</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
     title<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-watch-指定侦听"><a href="#_2-watch-指定侦听" class="header-anchor">#</a> 2. watch 指定侦听</h4> <ul><li>watch 的参数
<ul><li>第一个参数为监听的对象
<ul><li>可多个侦听，传入数组</li></ul></li> <li>第二个参数为回调函数</li> <li>第三个参数为配置
<ul><li><code>deep</code> 深度侦听</li> <li><code>immediate</code> 立即执行</li></ul></li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// 1.定义可响应对象</span>
    <span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;why&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
      <span class="token literal-property property">friend</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;kobe&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2.侦听器watch</span>
    <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span>info<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;newValue:&quot;</span><span class="token punctuation">,</span> newValue<span class="token punctuation">,</span> <span class="token string">&quot;oldValue:&quot;</span><span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
      <span class="token literal-property property">deep</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//深度侦听</span>
      <span class="token literal-property property">immediate</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token comment">//立即执行</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token function-variable function">changeInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      info<span class="token punctuation">.</span>friend<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;lpz&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_4、在setup中使用ref"><a href="#_4、在setup中使用ref" class="header-anchor">#</a> 4、在setup中使用ref</h2> <ul><li>在<code>setup</code>中定义一个<code>ref</code>对象</li> <li>并设置给行内元素的<code>ref</code>即可</li></ul> <p><strong>示例</strong></p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token operator">&lt;</span>h2 ref<span class="token operator">=</span><span class="token string">&quot;title&quot;</span><span class="token operator">&gt;</span>哈哈哈<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> watchEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>

 <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
      <span class="token literal-property property">flush</span><span class="token operator">:</span><span class="token string">&quot;post&quot;</span><span class="token comment">//第一次不监听/不然第一次是null</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
     title<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="_5、render函数与h函数"><a href="#_5、render函数与h函数" class="header-anchor">#</a> 5、render函数与h函数</h2> <p><strong>render函数为渲染函数，使用render时不需要template模板</strong></p> <p><strong>h函数为渲染每一个节点函数，并且有三个参数</strong></p> <ul><li>第一个参数为节点名称(<code>必须</code>) 例如 ： div h2 span</li> <li>第二个参数为节点的属性(<code>可选官方建议如果没有就传null</code>)，例如class、点击事件、属性</li> <li>第三个参数为子节点(<code>可选</code>) 可嵌套</li></ul> <p><strong>实例：render与h函数的基本使用</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>  h <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
   <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;h2&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token keyword">class</span><span class="token operator">:</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;Hello Render&quot;</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>实例：实现计数器（也可以放在setup返回值,setup返回一个函数）</strong></p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// return {</span>
    <span class="token comment">//   counter,</span>
    <span class="token comment">// };</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&quot;app&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;h2&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">当前计数：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>counter<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">h</span><span class="token punctuation">(</span>
        <span class="token string">&quot;button&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token function-variable function">onClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> counter<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;+1&quot;</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">h</span><span class="token punctuation">(</span>
        <span class="token string">&quot;button&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token function-variable function">onClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> counter<span class="token punctuation">.</span>value<span class="token operator">--</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;-1&quot;</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">//   render() {</span>
<span class="token comment">//     return h(&quot;div&quot;, { class: &quot;app&quot; }, [</span>
<span class="token comment">//       h(&quot;h2&quot;, null, `当前计数：${this.counter}`),</span>
<span class="token comment">//       h(</span>
<span class="token comment">//         &quot;button&quot;,</span>
<span class="token comment">//         {</span>
<span class="token comment">//           onClick: () =&gt; this.counter++,</span>
<span class="token comment">//         },</span>
<span class="token comment">//         &quot;+1&quot;</span>
<span class="token comment">//       ),</span>
<span class="token comment">//       h(</span>
<span class="token comment">//         &quot;button&quot;,</span>
<span class="token comment">//         {</span>
<span class="token comment">//           onClick: () =&gt; this.counter--,</span>
<span class="token comment">//         },</span>
<span class="token comment">//         &quot;-1&quot;</span>
<span class="token comment">//       ),</span>
<span class="token comment">//     ]);</span>
<span class="token comment">//   },</span>
</code></pre></div><p><strong>实例：使用插槽</strong></p> <ul><li>App.vue</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> HelloWorld <span class="token keyword">from</span> <span class="token string">&quot;./HelloWorld.vue&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>HelloWorld<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;span&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">我是传入的插槽 插槽的参数</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//props中装载着传过来的值</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>HelloWorld.vue</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">import</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
      <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;h2&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span>default
        <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;lpz&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">//这里可以传值给app.vue</span>
        <span class="token operator">:</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;span&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;我是HelloWorld的默认值&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//这里收集插槽，如果有名字为default的插槽就使用插槽,否则输出一个span</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_6、directives-自定义指令"><a href="#_6、directives-自定义指令" class="header-anchor">#</a> 6、directives(自定义指令)</h2> <h3 id="_1-基本使用"><a href="#_1-基本使用" class="header-anchor">#</a> 1. 基本使用</h3> <p><strong>说明：</strong></p> <p>自定义指令的生命周期中都传入了四个参数</p> <ul><li>第一个参数：<code>el</code>   当前<code>Dom</code>元素</li> <li>第二个参数为：<code>bindings</code> 装载自定义指令的传值与修饰符
<ul><li>其中：value为传入的值</li> <li>modifiers 为修饰符，</li></ul></li> <li>第三个参数为虚拟节点 <code>vnode</code></li> <li>第四个参数为前一个虚拟节点 <code>preVnode</code></li></ul> <h5 id="局部自定义指令"><a href="#局部自定义指令" class="header-anchor">#</a> 局部自定义指令</h5> <ul><li>局部自定义指令设置在每一个单独的组件中</li> <li>自定义指令,第一个参数为名字,第二个为回调函数</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button
      v<span class="token operator">-</span>button<span class="token punctuation">.</span>aaa<span class="token punctuation">.</span>bbb<span class="token operator">=</span><span class="token string">&quot;'自定义指令传值'&quot;</span>
      v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;counter &lt; 3&quot;</span>
      @click<span class="token operator">=</span><span class="token string">&quot;increment&quot;</span>
    <span class="token operator">&gt;</span>
      <span class="token literal-property property">计数器</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span> counter <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> onMounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">directives</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//局部动态自定义指令</span>
    <span class="token literal-property property">button</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">created</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> bindings<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> preVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// bindings 为自定义指令传值与修饰符的容器</span>
        <span class="token comment">//value 为传入的数据 </span>
        <span class="token comment">// modifiers 为修饰符 会为true</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;modifiers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;created&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bindings<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">beforeMount</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> bindings<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> preVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;beforeMount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> bindings<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> preVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;beforeMount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">beforeUpdate</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> bindings<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> preVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;beforeUpdate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">updated</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> bindings<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> preVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;updated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">beforeUnmount</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> bindings<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> preVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;beforeUnmount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">unmounted</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> bindings<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> preVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;unmounted&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      counter<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      counter<span class="token punctuation">,</span>
      increment<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

</code></pre></div><h5 id="全局自定义指令"><a href="#全局自定义指令" class="header-anchor">#</a> 全局自定义指令</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">&quot;focus&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">//全局自定义指令,第一个参数为名字,第二个为回调函数</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> bindings<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> preVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    el<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="封装全局数据格式化"><a href="#封装全局数据格式化" class="header-anchor">#</a> 封装全局数据格式化</h5> <p><strong>可用于需要统一理的数据</strong></p> <p><img src="/Pz-blog/assets/img/image-20211007142318140.364117ed.png" alt="avatar"></p> <img src="/Pz-blog/assets/img/image-20211007142318140.364117ed.png" alt="image-20211007142318140" style="zoom:100%;"> <h3 id="_2-指令的生命周期"><a href="#_2-指令的生命周期" class="header-anchor">#</a> 2. 指令的生命周期</h3> <p><img src="/Pz-blog/assets/img/image-20211007130728367.5642e01b.png" alt="avatar"></p> <h2 id="_7、teleport-template插入到指定容器中"><a href="#_7、teleport-template插入到指定容器中" class="header-anchor">#</a> 7、teleport（template插入到指定容器中）</h2> <p><strong>作用：将元素插入到指定容器中</strong></p> <ul><li>app.vue</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>teleport to<span class="token operator">=</span><span class="token string">&quot;#lpz&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>teleport<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>插入到id为lpz的容器中<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>teleport<span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>teleport to<span class="token operator">=</span><span class="token string">&quot;#lpz&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>追加<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>teleport<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre></div><ul><li>index.html</li></ul> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;lpz&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre></div><p><strong>效果</strong></p> <p><img src="/Pz-blog/assets/img/image-20211007145028270.c7be895a.png" alt="avatar"></p> <h2 id="_8、全局注册插件-app-use"><a href="#_8、全局注册插件-app-use" class="header-anchor">#</a> 8、全局注册插件(app.use())</h2> <p><strong>说明：</strong></p> <p>全局注册插件</p> <ul><li>对象形式
<ul><li>会去调用对象中的<code>install</code>方法并且传入app实例</li></ul></li> <li>函数形式
<ul><li>注册函数插件直接将app传给函数</li> <li>并且可以使用 全局<code>mixin</code>、<code>component</code>等事件</li></ul></li></ul> <p><strong>mian.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> pluginsObject <span class="token keyword">from</span> <span class="token string">&quot;./plugins/plugins_object.js&quot;</span>
<span class="token keyword">import</span> pluginsFuntion <span class="token keyword">from</span> <span class="token string">&quot;./plugins/plugins_Funtion.js&quot;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>pluginsObject<span class="token punctuation">)</span><span class="token comment">//这里注册插件其实直接会调用里边的install方法,并且转入app</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>pluginsFuntion<span class="token punctuation">)</span><span class="token comment">//注册函数插件直接将app传给函数</span>
</code></pre></div><p><strong>lugins_object.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">install</span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>$name <span class="token operator">=</span> <span class="token string">&quot;lpz&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><p><strong>plugins_Funtion.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre></div><p><strong>在组件中使用全局属性</strong></p> <ul><li>setup</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>getCurrentInstance<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token comment">//获取组件实例 </span>
<span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//获取组件实例</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>appContext<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>$name<span class="token punctuation">)</span><span class="token comment">//setup获取全局注册实例属性</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

</code></pre></div><ul><li>vue2</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>        <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$name<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h1 id="四、vue中认识jsx"><a href="#四、vue中认识jsx" class="header-anchor">#</a> 四、Vue中认识jsx</h1> <h2 id="_1、基本使用"><a href="#_1、基本使用" class="header-anchor">#</a> 1、基本使用</h2> <p><strong>目前VueCli 4.5.0 已经默认支持jsx</strong></p> <ul><li>App.vue</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span>
<span class="token keyword">import</span> HelloWorld <span class="token keyword">from</span> <span class="token string">&quot;./HelloWorld.vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">{</span>
            counter
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>counter<span class="token operator">++</span>
      <span class="token keyword">const</span> <span class="token function-variable function">decrement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>counter<span class="token operator">--</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
       <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>当前计数 <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>counter<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>increment<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>decrement<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>HelloWorld<span class="token operator">&gt;</span>
          <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token function-variable function">default</span><span class="token operator">:</span><span class="token parameter">props</span><span class="token operator">=&gt;</span><span class="token operator">&lt;</span>button<span class="token operator">&gt;</span>我是传入的数据插槽<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>HelloWorld<span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
</code></pre></div><ul><li>HelloWorld.vue</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>Hello World<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span>default<span class="token operator">?</span><span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>哈哈哈<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
</code></pre></div><h1 id="五、vuex五大核心"><a href="#五、vuex五大核心" class="header-anchor">#</a> 五、VueX五大核心</h1> <h2 id="_1、state"><a href="#_1、state" class="header-anchor">#</a> 1、state</h2> <h2 id="_2、getters"><a href="#_2、getters" class="header-anchor">#</a> 2、getters</h2> <h1 id="六、typescript-与-vue3"><a href="#六、typescript-与-vue3" class="header-anchor">#</a> 六、TypeScript 与 Vue3</h1> <h2 id="_1、类型"><a href="#_1、类型" class="header-anchor">#</a> 1、类型</h2> <h3 id="_1-1-ref-获取组件-instancetype"><a href="#_1-1-ref-获取组件-instancetype" class="header-anchor">#</a> 1.1 ref () 获取组件   InstanceType</h3> <blockquote><p>利用 InstanceType (实例类型) 来获取拥有构造函数的实例</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token operator">&lt;</span>login<span class="token operator">-</span>account ref<span class="token operator">=</span><span class="token string">&quot;accountRef&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token comment">//组件</span>

    <span class="token comment">//使用ref获取组件实例</span>

<span class="token keyword">const</span> accountRef <span class="token operator">=</span> ref<span class="token operator">&lt;</span>InstanceType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> LoginAccount<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_1-2-使用-vuex-usestore"><a href="#_1-2-使用-vuex-usestore" class="header-anchor">#</a> 1.2 使用 Vuex useStore *</h3> <p><strong>问题：</strong></p> <blockquote><p>因 vuex 对 typeScript 支持不友好，在vuex的useStore中的类型为any 并没有类型检测，如下：</p></blockquote> <p><img src="/Pz-blog/assets/img/image-20220116125414319.b2269327.png" alt="avatar"></p> <p><strong>解决问题：</strong></p> <blockquote><p>处理 <strong>useStore</strong> ， 在store的index.ts中导出一个函数替换useStore</p></blockquote> <p><img src="/Pz-blog/assets/img/image-20220116125756965.0e416ffb.png" alt="avatar"></p> <p><img src="/Pz-blog/assets/img/image-20220116130212788.6657e643.png" alt="avatar"></p> <p><strong>结果：</strong></p> <h2 id="_2、router"><a href="#_2、router" class="header-anchor">#</a> 2、router</h2> <h3 id="_2-1-动态路由创建文件"><a href="#_2-1-动态路由创建文件" class="header-anchor">#</a> 2.1 动态路由创建文件</h3> <blockquote><p>避免手动创建文件 与 router 映射 使用 corderwhy 的工具</p></blockquote> <ol><li><strong>安装工具</strong></li></ol> <p>npm工具名称 : **“corderwhy” **</p> <div class="language-cmd extra-class"><pre class="language-text"><code>npm install corderwhy
</code></pre></div><ol start="2"><li>**使用 **</li></ol> <div class="language-cmd extra-class"><pre class="language-text"><code>#这里的文件路径与路由路径一致，(建议与接口返回路径一致)

coderthy add3page 文件名称 -d 文件路径
coderwhy add3page test -d src/views/main/test

</code></pre></div><ol start="3"><li><strong>结果</strong></li></ol> <blockquote><p>会根据命令创建出不同的 路由 与 vue文件 （并有相应代码）</p></blockquote> <p><img src="/Pz-blog/assets/img/image-20220116142744756.a90838b3.png" alt="avatar"></p> <h3 id="_2-2-require-context-加载文件使用"><a href="#_2-2-require-context-加载文件使用" class="header-anchor">#</a> 2.2 require.context 加载文件使用</h3> <blockquote><p><strong>require.context</strong> 是 <strong>webpack</strong> 中的方法，可加载上下文 文件</p></blockquote> <ol><li><strong>使用方法</strong></li></ol> <blockquote><p>1、<strong>require.context</strong>(查找的文件夹路径, 是否进行递归查找, 匹配的文件（正则）)</p> <p>2、使用 <strong>routeFiles.keys()</strong> 获取加载到的所有文件</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">const</span> routeFiles <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">'../router/main'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.ts</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// console.log(routeFiles.keys());</span>

<span class="token function">获取到</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>router<span class="token operator">/</span>main<span class="token punctuation">)</span>相对路径
<span class="token comment">//[&quot;./analysis/dashboard/dashboard.ts&quot;,&quot;./analysis/overview/overview.ts&quot;]</span>
</code></pre></div><h3 id="_2-3-实现动态路由"><a href="#_2-3-实现动态路由" class="header-anchor">#</a> 2.3 实现动态路由</h3> <p><strong>注意：</strong></p> <ul><li>动态路由中 <strong>el-menu</strong> 组件用的是后台传回来的数组(store.state.login.userMenus)</li></ul> <p>大致结构：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">38</span><span class="token punctuation">,</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;系统总览&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/main/analysis&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;el-icon-monitor&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;children&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">39</span><span class="token punctuation">,</span>
                <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/main/analysis/overview&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;核心技术&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token number">106</span><span class="token punctuation">,</span>
                <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                <span class="token property">&quot;children&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
                <span class="token property">&quot;parentId&quot;</span><span class="token operator">:</span> <span class="token number">38</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;商品中心&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/main/product&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;el-icon-goods&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">&quot;children&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
                <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/main/product/category&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;商品类别&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token number">104</span><span class="token punctuation">,</span>
                <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                <span class="token property">&quot;children&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;创建类别&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;parentId&quot;</span><span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;permission&quot;</span><span class="token operator">:</span> <span class="token string">&quot;system:category:create&quot;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token property">&quot;parentId&quot;</span><span class="token operator">:</span> <span class="token number">9</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
 
<span class="token punctuation">]</span>
</code></pre></div><blockquote><p>map-menus.ts 文件</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> RouteRecordRaw <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue-router'</span><span class="token punctuation">;</span>
<span class="token comment">// allRoutes为所有的 userMenus为请求回来的</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">mapMenusToRoutes</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">userMenus</span><span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span><span class="token operator">:</span> RouteRecordRaw<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token literal-property property">routes</span><span class="token operator">:</span> RouteRecordRaw<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// 1.先去加载默认所有的routes</span>
  <span class="token keyword">const</span> <span class="token literal-property property">allRoutes</span><span class="token operator">:</span> RouteRecordRaw<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// require.context加载文件夹</span>
  <span class="token comment">// require.context(文件夹路径, 是否进行递归查找, 匹配的文件)</span>
  <span class="token comment">// const routeFiles = require.context('../router/main', true, /\.ts$/);//以ts结尾</span>
  <span class="token keyword">const</span> routeFiles <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">'../router/main'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.ts</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//.ts/.tsx</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>routeFiles<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 使用keys获取值</span>
  routeFiles<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 循环获取单个文件(因获取的是相对路径所以使用 . 来切割)</span>
    <span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../router/main'</span> <span class="token operator">+</span> key<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// route.default获取的就是route对象了</span>
    allRoutes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>allRoutes<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 2.根据菜单获取需要添加的routes</span>
  <span class="token comment">// userMenus:</span>
  <span class="token comment">// type === 1 -&gt; children -&gt; type === 1</span>
  <span class="token comment">// type === 2 -&gt; url -&gt; route</span>
  <span class="token keyword">const</span> <span class="token function-variable function">_recurseGetRoute</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">menus</span><span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> menu <span class="token keyword">of</span> menus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>menu<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>menu<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> route <span class="token operator">=</span> allRoutes<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">route</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> route<span class="token punctuation">.</span>path <span class="token operator">===</span> menu<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>route<span class="token punctuation">)</span> routes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">_recurseGetRoute</span><span class="token punctuation">(</span>menu<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">_recurseGetRoute</span><span class="token punctuation">(</span>userMenus<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> routes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><blockquote><p>vuex store 文件</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mapMenusToRoutes <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/map-menus'</span><span class="token punctuation">;</span>  
<span class="token literal-property property">mutations</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">changeUserMenus</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token literal-property property">userMenus</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>userMenus <span class="token operator">=</span> userMenus<span class="token punctuation">;</span>

      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'注册动态路由'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// userMenus =&gt; routes</span>
      <span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token function">mapMenusToRoutes</span><span class="token punctuation">(</span>userMenus<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 将routes =&gt; router.main.children</span>
      routes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">route</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 添加到main路径下</span>
        router<span class="token punctuation">.</span><span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token string">'main'</span><span class="token punctuation">,</span> route<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="_2-4-路由注册执行顺序"><a href="#_2-4-路由注册执行顺序" class="header-anchor">#</a> 2.4 路由注册执行顺序</h3> <p><img src="/Pz-blog/assets/img/image-20220121121703169.65a2922f.png" alt="avatar"></p> <h2 id="_3、组件中的双向绑定"><a href="#_3、组件中的双向绑定" class="header-anchor">#</a> 3、组件中的双向绑定</h2> <h3 id="_3-1-方式"><a href="#_3-1-方式" class="header-anchor">#</a> 3.1 方式</h3> <h4 id="_3-1-1-子组件使用v-bind直接修改props-不推荐"><a href="#_3-1-1-子组件使用v-bind直接修改props-不推荐" class="header-anchor">#</a> 3.1.1 子组件使用v-bind直接修改props(不推荐)</h4> <p><strong>不推荐原因</strong></p> <blockquote><p>Vue设计原则为单项数据留，建议不要子组件直接修改 <strong>props</strong></p> <p>eslint 也会报错如下</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>Unexpected mutation <span class="token keyword">of</span> <span class="token string">&quot;formData&quot;</span> prop<span class="token punctuation">.</span>eslintvue<span class="token operator">/</span>no<span class="token operator">-</span>mutating<span class="token operator">-</span>props
<span class="token comment">// no-mutating-props: 不要变化props</span>
“formData”prop<span class="token punctuation">.</span>eslintvue<span class="token operator">/</span>no<span class="token operator">-</span>mutating<span class="token operator">-</span>props的意外突变
</code></pre></div><p><strong>使用方案</strong></p> <div class="language-typescript extra-class"><pre class="language-typescript"><code> <span class="token comment">//子组件    formData为数据 searchFormConfig为动态绑定配置文件</span>
<span class="token operator">&lt;</span>hy<span class="token operator">-</span>form v<span class="token operator">-</span>bind<span class="token operator">=</span><span class="token string">&quot;searchFormConfig&quot;</span> <span class="token operator">:</span>formData<span class="token operator">=</span><span class="token string">&quot;formData&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token comment">//父组件</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      passwor<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      sport<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      createTime<span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      formData<span class="token punctuation">,</span>
      searchFormConfig
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//传给组件配置文件</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> IForm <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/base-ui/form'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> searchFormConfig<span class="token operator">:</span> IForm <span class="token operator">=</span> <span class="token punctuation">{</span>
  formItems<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      field<span class="token operator">:</span> <span class="token string">'id'</span><span class="token punctuation">,</span><span class="token comment">//这里为绑定model</span>
      type<span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
      label<span class="token operator">:</span> <span class="token string">'id'</span><span class="token punctuation">,</span>
      placeholder<span class="token operator">:</span> <span class="token string">'请输入id'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//子组件使用</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    formData<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Object<span class="token punctuation">,</span>
      required<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token operator">&lt;</span>el<span class="token operator">-</span>input
    <span class="token operator">:</span>placeholder<span class="token operator">=</span><span class="token string">&quot;item.placeholder&quot;</span>
    v<span class="token operator">-</span>bind<span class="token operator">=</span><span class="token string">&quot;item.otherOptions&quot;</span>
    <span class="token operator">:</span>show<span class="token operator">-</span>password<span class="token operator">=</span><span class="token string">&quot;item.type === 'password'&quot;</span>
    v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;formData[`${item.field}`]&quot;</span><span class="token comment">//用配置文件的field绑定formData中的字段</span>
  <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><p><strong>实现成果</strong></p> <p><img src="/Pz-blog/assets/img/image-20220122151442939.60f08a40.png" alt="avatar"></p> <h4 id="_3-1-2-使用组件双向绑定-v-model-modelvalue-误区"><a href="#_3-1-2-使用组件双向绑定-v-model-modelvalue-误区" class="header-anchor">#</a> 3.1.2 使用组件双向绑定 v-model modelValue (误区)</h4> <p><strong>使用方案</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//将动态绑定修改为v-mode (组件双向绑定)</span>
<span class="token comment">//&lt;hy-form v-bind=&quot;searchFormConfig&quot; :formData=&quot;formData&quot; /&gt;</span>
<span class="token comment">//这里其实跟3.1.1的思路是相同的 用 :modelValue=&quot;formData&quot; 也是一样的结果</span>
<span class="token operator">&lt;</span>hy<span class="token operator">-</span>form v<span class="token operator">-</span>bind<span class="token operator">=</span><span class="token string">&quot;searchFormConfig&quot;</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;formData&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token comment">//子组件</span>
     <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">modelValue</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span>
<span class="token comment">//发出事件 updata:modelValue (可随意修改)</span>
 <span class="token literal-property property">emits</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'update:modelValue'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> <span class="token punctuation">{</span> emit <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//计算属性 双向绑定</span>
    <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span>modelValue<span class="token punctuation">,</span><span class="token comment">//获取</span>
      <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">//设置</span>
  # 并且这里并没有调用 
  			concsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'-------'</span><span class="token punctuation">)</span>
        <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'update:modelValue'</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      formData
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-1-3-使用v-model并使用watch监听-正确用法"><a href="#_3-1-3-使用v-model并使用watch监听-正确用法" class="header-anchor">#</a> 3.1.3 使用v-model并使用watch监听(正确用法)</h4> <p><strong>使用方案</strong></p> <blockquote><p>遵循 <strong>Vue</strong> 单向数据流规则 使用 **emit ** 发出数据变化</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token comment">//父组件</span>
<span class="token operator">&lt;</span>hy<span class="token operator">-</span>form v<span class="token operator">-</span>bind<span class="token operator">=</span><span class="token string">&quot;searchFormConfig&quot;</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;formData&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

   
   
<span class="token comment">//子组件</span>
<span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">modelValue</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">}</span>


 <span class="token literal-property property">emits</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'update:modelValue'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> <span class="token punctuation">{</span> emit <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">//在组件中定义一个ref</span>
      <span class="token operator">...</span>props<span class="token punctuation">.</span>modelValue
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">watch</span><span class="token punctuation">(</span><span class="token comment">//监听变量变化并传出去</span>
      formData<span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">789</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'update:modelValue'</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      formData
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/Pz-blog/assets/js/app.eed66c3b.js" defer></script><script src="/Pz-blog/assets/js/2.652b4c3a.js" defer></script><script src="/Pz-blog/assets/js/3.b1d40e3b.js" defer></script>
  </body>
</html>

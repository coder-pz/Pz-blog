<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一、React Hooks | Pz&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="/Pz-blog/images/head_photo.jpg">
    <meta name="description" content="Pz&#39;s blog">
    
    <link rel="preload" href="/Pz-blog/assets/css/0.styles.aa251390.css" as="style"><link rel="preload" href="/Pz-blog/assets/js/app.6f56e517.js" as="script"><link rel="preload" href="/Pz-blog/assets/js/2.9b71ad29.js" as="script"><link rel="preload" href="/Pz-blog/assets/js/14.8b0dca08.js" as="script"><link rel="prefetch" href="/Pz-blog/assets/js/10.3db1de7f.js"><link rel="prefetch" href="/Pz-blog/assets/js/11.4d64af3c.js"><link rel="prefetch" href="/Pz-blog/assets/js/12.867b9f21.js"><link rel="prefetch" href="/Pz-blog/assets/js/13.9c304674.js"><link rel="prefetch" href="/Pz-blog/assets/js/15.6c5ef77c.js"><link rel="prefetch" href="/Pz-blog/assets/js/16.93a42712.js"><link rel="prefetch" href="/Pz-blog/assets/js/17.8eeca1c4.js"><link rel="prefetch" href="/Pz-blog/assets/js/18.bbe83633.js"><link rel="prefetch" href="/Pz-blog/assets/js/19.b19c67fb.js"><link rel="prefetch" href="/Pz-blog/assets/js/20.be74d95e.js"><link rel="prefetch" href="/Pz-blog/assets/js/21.3cbd20e2.js"><link rel="prefetch" href="/Pz-blog/assets/js/22.a0fc5e74.js"><link rel="prefetch" href="/Pz-blog/assets/js/23.009e0378.js"><link rel="prefetch" href="/Pz-blog/assets/js/24.cb67e91d.js"><link rel="prefetch" href="/Pz-blog/assets/js/25.5e34a6dd.js"><link rel="prefetch" href="/Pz-blog/assets/js/26.1a1a031f.js"><link rel="prefetch" href="/Pz-blog/assets/js/3.92ba80c7.js"><link rel="prefetch" href="/Pz-blog/assets/js/4.b58648d1.js"><link rel="prefetch" href="/Pz-blog/assets/js/5.56c171cd.js"><link rel="prefetch" href="/Pz-blog/assets/js/6.5160e042.js"><link rel="prefetch" href="/Pz-blog/assets/js/7.b27b7560.js"><link rel="prefetch" href="/Pz-blog/assets/js/8.a5eb90a8.js"><link rel="prefetch" href="/Pz-blog/assets/js/9.55f2e7b8.js">
    <link rel="stylesheet" href="/Pz-blog/assets/css/0.styles.aa251390.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Pz-blog/" class="home-link router-link-active"><!----> <span class="site-name">Pz's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          构建工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/buildTools/webpack.html" class="nav-link">
  webpack
</a></li></ul></li><li class="dropdown-item"><h4>
          操作数据
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/js/数组操作.html" class="nav-link">
  数组操作
</a></li></ul></li><li class="dropdown-item"><h4>
          数据请求
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/dataRequest/axios.html" class="nav-link">
  axios
</a></li></ul></li><li class="dropdown-item"><h4>
          布局
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/layout/flex布局.html" class="nav-link">
  flex布局
</a></li><li class="dropdown-subitem"><a href="/Pz-blog/notebook/layout/Grid布局.html" class="nav-link">
  Grid布局
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript" class="mobile-dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Pz-blog/notebook/js/js进阶/JS进阶1.html" class="nav-link">
  js进阶1
</a></li><li class="dropdown-item"><!----> <a href="/Pz-blog/notebook/js/js进阶/JS进阶2.html" class="nav-link">
  js进阶2
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Vue2
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/Vue/Vue2/Vue指令.html" class="nav-link">
  Vue指令
</a></li><li class="dropdown-subitem"><a href="/Pz-blog/notebook/Vue/Vue2/Vue-router.html" class="nav-link">
  VueRouter
</a></li></ul></li><li class="dropdown-item"><h4>
          Vue3
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/Vue/Vue3/Vue3.html" class="nav-link">
  Vue3基本使用
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React" class="dropdown-title"><span class="title">React</span> <span class="arrow down"></span></button> <button type="button" aria-label="React" class="mobile-dropdown-title"><span class="title">React</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Pz-blog/notebook/React/react-base.html" class="nav-link">
  基础使用
</a></li><li class="dropdown-item"><!----> <a href="/Pz-blog/notebook/React/react-redux.html" class="nav-link">
  react-redux
</a></li><li class="dropdown-item"><!----> <a href="/Pz-blog/notebook/React/react-hooks.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  react-hooks
</a></li><li class="dropdown-item"><!----> <a href="/Pz-blog/notebook/React/project-build.html" class="nav-link">
  项目搭建
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="探索原理" class="dropdown-title"><span class="title">探索原理</span> <span class="arrow down"></span></button> <button type="button" aria-label="探索原理" class="mobile-dropdown-title"><span class="title">探索原理</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Pz-blog/notebook/learnPrinciple/探索原理.html" class="nav-link">
  javaScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码管理" class="dropdown-title"><span class="title">代码管理</span> <span class="arrow down"></span></button> <button type="button" aria-label="代码管理" class="mobile-dropdown-title"><span class="title">代码管理</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Pz-blog/notebook/git/Git.html" class="nav-link">
  git
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          构建工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/buildTools/webpack.html" class="nav-link">
  webpack
</a></li></ul></li><li class="dropdown-item"><h4>
          操作数据
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/js/数组操作.html" class="nav-link">
  数组操作
</a></li></ul></li><li class="dropdown-item"><h4>
          数据请求
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/dataRequest/axios.html" class="nav-link">
  axios
</a></li></ul></li><li class="dropdown-item"><h4>
          布局
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/layout/flex布局.html" class="nav-link">
  flex布局
</a></li><li class="dropdown-subitem"><a href="/Pz-blog/notebook/layout/Grid布局.html" class="nav-link">
  Grid布局
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript" class="mobile-dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Pz-blog/notebook/js/js进阶/JS进阶1.html" class="nav-link">
  js进阶1
</a></li><li class="dropdown-item"><!----> <a href="/Pz-blog/notebook/js/js进阶/JS进阶2.html" class="nav-link">
  js进阶2
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Vue2
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/Vue/Vue2/Vue指令.html" class="nav-link">
  Vue指令
</a></li><li class="dropdown-subitem"><a href="/Pz-blog/notebook/Vue/Vue2/Vue-router.html" class="nav-link">
  VueRouter
</a></li></ul></li><li class="dropdown-item"><h4>
          Vue3
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Pz-blog/notebook/Vue/Vue3/Vue3.html" class="nav-link">
  Vue3基本使用
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React" class="dropdown-title"><span class="title">React</span> <span class="arrow down"></span></button> <button type="button" aria-label="React" class="mobile-dropdown-title"><span class="title">React</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Pz-blog/notebook/React/react-base.html" class="nav-link">
  基础使用
</a></li><li class="dropdown-item"><!----> <a href="/Pz-blog/notebook/React/react-redux.html" class="nav-link">
  react-redux
</a></li><li class="dropdown-item"><!----> <a href="/Pz-blog/notebook/React/react-hooks.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  react-hooks
</a></li><li class="dropdown-item"><!----> <a href="/Pz-blog/notebook/React/project-build.html" class="nav-link">
  项目搭建
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="探索原理" class="dropdown-title"><span class="title">探索原理</span> <span class="arrow down"></span></button> <button type="button" aria-label="探索原理" class="mobile-dropdown-title"><span class="title">探索原理</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Pz-blog/notebook/learnPrinciple/探索原理.html" class="nav-link">
  javaScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码管理" class="dropdown-title"><span class="title">代码管理</span> <span class="arrow down"></span></button> <button type="button" aria-label="代码管理" class="mobile-dropdown-title"><span class="title">代码管理</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Pz-blog/notebook/git/Git.html" class="nav-link">
  git
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>一、React Hooks</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Pz-blog/notebook/React/react-hooks.html#一、react-hooks" class="sidebar-link">一、React Hooks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_1、为什么需要hook" class="sidebar-link">1、为什么需要Hook?</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_2、usestate" class="sidebar-link">2、useState</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_3、useeffect" class="sidebar-link">3、useEffect</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_4、usecontext" class="sidebar-link">4、useContext</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_5、-usereducer-特殊情况usestate的替代品" class="sidebar-link">5、 useReducer (特殊情况useState的替代品)</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_6、-usecallback" class="sidebar-link">6、 useCallback</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_7、-usememo" class="sidebar-link">7、 useMemo</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_8、useref" class="sidebar-link">8、useRef</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_9、useimperativehandle" class="sidebar-link">9、useImperativeHandle</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_10、uselayouteffect" class="sidebar-link">10、useLayoutEffect</a></li></ul></li><li><a href="/Pz-blog/notebook/React/react-hooks.html#二、自定义hooks" class="sidebar-link">二、自定义hooks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_1、设置本地localstorage" class="sidebar-link">1、设置本地localStorage</a></li></ul></li><li><a href="/Pz-blog/notebook/React/react-hooks.html#三、-redux-中的hooks" class="sidebar-link">三、 redux 中的hooks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_1、useselector" class="sidebar-link">1、useSelector</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_2、usedispatch" class="sidebar-link">2、useDispatch</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_3、shallowequal" class="sidebar-link">3、shallowEqual</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_1-2-3-代码示例" class="sidebar-link">1.2.3 代码示例</a></li></ul></li><li><a href="/Pz-blog/notebook/React/react-hooks.html#四、ssr与spa" class="sidebar-link">四、SSR与SPA</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_1、spa单页面富应用的两个缺点" class="sidebar-link">1、SPA单页面富应用的两个缺点</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_2、ssr" class="sidebar-link">2、SSR</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_3、ssr同构应用" class="sidebar-link">3、SSR同构应用</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_4、hydration" class="sidebar-link">4、Hydration</a></li></ul></li><li><a href="/Pz-blog/notebook/React/react-hooks.html#五、useid" class="sidebar-link">五、useId</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_1、作用与使用" class="sidebar-link">1、作用与使用</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_2、代码示例" class="sidebar-link">2、代码示例</a></li></ul></li><li><a href="/Pz-blog/notebook/React/react-hooks.html#六、usetransition" class="sidebar-link">六、useTransition</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_1、作用与使用-2" class="sidebar-link">1、作用与使用</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_2、代码示例-2" class="sidebar-link">2、代码示例</a></li></ul></li><li><a href="/Pz-blog/notebook/React/react-hooks.html#七、usedeferredvalue" class="sidebar-link">七、useDeferredValue</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_1、作用与使用-3" class="sidebar-link">1、作用与使用</a></li><li class="sidebar-sub-header"><a href="/Pz-blog/notebook/React/react-hooks.html#_2、代码示例-3" class="sidebar-link">2、代码示例</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="一、react-hooks"><a href="#一、react-hooks" class="header-anchor">#</a> 一、React Hooks</h2> <h3 id="_1、为什么需要hook"><a href="#_1、为什么需要hook" class="header-anchor">#</a> 1、为什么需要Hook?</h3> <ul><li>Hook 是 React 16.8 的新增特性，hooks可以让我们在不编写class的情况下使用<code>state、生命周期</code>等特性。</li></ul> <h4 id="_1-1-class-组件的优势"><a href="#_1-1-class-组件的优势" class="header-anchor">#</a> 1.1 class 组件的优势</h4> <ul><li>class组件可以定义自己的state，用来保存组件自己内部的状态
<ul><li>函数式组件不可以，因为函数每次调用都会产生新的临时变量；</li></ul></li> <li>class组件有自己的生命周期，我们可以在对应的生命周期中完成自己的逻辑
<ul><li>比如在componentDidMount中发送网络请求，并且该生命周期函数只会执行一次；</li> <li>函数式组件在学习hooks之前，如果在函数中发送网络请求，意味着每次重新渲染都会重新发送一次网络请求；</li></ul></li> <li>class组件可以在状态改变时只会重新执行render函数以及我们希望重新调用的生命周期函数componentDidUpdate等；
<ul><li>函数式组件在重新渲染时，整个函数都会被执行，似乎没有什么地方可以只让它们调用一次；</li></ul></li></ul> <h4 id="_1-2-class组件的劣势"><a href="#_1-2-class组件的劣势" class="header-anchor">#</a> 1.2 class组件的劣势</h4> <ul><li><strong>复杂组件变得难以理解</strong> <ul><li>编写一个class组件会出现特别多的代码量，并且随着业务的增多代码量也会变大，也会越来越难维护</li></ul></li> <li><strong>组件复用状态很难</strong> <ul><li>使用高阶组件可以让class组件复用起来，
<ul><li>但是逻辑一复杂，Provider、Consumer 共享一些状态，嵌套就会很多，代码很乱</li></ul></li></ul></li></ul> <h4 id="_1-3-hooks的出现"><a href="#_1-3-hooks的出现" class="header-anchor">#</a> 1.3 hooks的出现</h4> <ul><li>hooks 可以让函数组件有状态，并且根据状态变化重新渲染等</li> <li>100% 向后兼容的**：**Hook 不包含任何破坏性改动</li> <li>无需因为要用hooks 就去将所有代码重构，hooks即便是在老项目中，也是可以使用的。</li></ul> <h3 id="_2、usestate"><a href="#_2、usestate" class="header-anchor">#</a> 2、useState</h3> <h4 id="_2-1-作用与使用"><a href="#_2-1-作用与使用" class="header-anchor">#</a> 2.1 作用与使用</h4> <ul><li>useState来自react，需要从react中导入，它是一个hook；
<ul><li>参数：初始化值，如果不设置为undefined；</li> <li>返回值：数组，包含两个元素；
<ul><li>元素一：当前状态的值（第一调用为初始化值）；</li> <li>元素二：设置状态值的函数</li></ul></li></ul></li></ul> <blockquote><p>Hook 就是 JavaScript 函数，这个函数可以帮助你 钩入（hook into） React State以及生命周期等特性；</p></blockquote> <h4 id="_2-2-两个额外规则"><a href="#_2-2-两个额外规则" class="header-anchor">#</a> 2.2 两个额外规则</h4> <ol><li>只能在函数最外层调用 Hook。不要在循环、条件判断或者子函数中调用。</li> <li>只能在 React 的函数组件中调用 Hook。不要在其他 JavaScript 函数中调用。</li></ol> <h4 id="_2-3-代码示例"><a href="#_2-3-代码示例" class="header-anchor">#</a> 2.3 代码示例</h4> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> memo<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// 普通的函数, 里面不能使用hooks</span>
<span class="token comment">// 在自定义的hooks中, 可以使用react提供的其他hooks: 必须使用use开头</span>
<span class="token comment">// function useFoo() {</span>
<span class="token comment">//   const [ message ] = useState(&quot;Hello World&quot;)</span>
<span class="token comment">//   return message</span>
<span class="token comment">// }</span>

<span class="token keyword">function</span> <span class="token function">CounterHook</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// useState 返回一个数组，数组中有两个值，第一个是state值，第二个是设置state的方法</span>
  <span class="token comment">//并且调用设置方法后会重新调用当前函数</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>counter<span class="token punctuation">,</span> setCounter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'lpz'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">当前计数: </span><span class="token punctuation">{</span>counter<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCounter</span><span class="token punctuation">(</span>counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCounter</span><span class="token punctuation">(</span>counter <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">-1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">memo</span><span class="token punctuation">(</span>CounterHook<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="_3、useeffect"><a href="#_3、useeffect" class="header-anchor">#</a> 3、useEffect</h3> <h4 id="_3-1-作用与使用"><a href="#_3-1-作用与使用" class="header-anchor">#</a> 3.1 作用与使用</h4> <h5 id="_3-1-1-作用"><a href="#_3-1-1-作用" class="header-anchor">#</a> 3.1.1 作用</h5> <blockquote><p>页面渲染完成后，才会按照代码顺序调用，不会阻塞DOM的更新</p></blockquote> <ul><li>帮助函数组件实现生命周期</li> <li>发送网络请求、添加监听事件，移除监听事件</li></ul> <h5 id="_3-1-2-使用"><a href="#_3-1-2-使用" class="header-anchor">#</a> 3.1.2 使用</h5> <ul><li><p>进入当前页面会调用一次</p></li> <li><p>每次数据变化函数调用也会调用一次</p> <ul><li>可以设置参数，设置依赖跟据某个值的变化来调用</li></ul></li> <li><p>useEffect 有两个参数</p> <ul><li>第一个参数为回调函数
<ul><li>返回一个回调函数</li> <li>监听事件时候卸载事件(相当于<code>componentWillUnmount</code>)</li></ul></li> <li>第二个参数为数组类型
<ul><li>表示受谁的影响，如果变化那么就调用，如果为空数组，那么谁的影响都不受，只在渲染时调用一次</li> <li>如果不传，那么不管谁变化都会触发回调</li></ul></li></ul></li></ul> <h4 id="_3-2-示例代码"><a href="#_3-2-示例代码" class="header-anchor">#</a> 3.2 示例代码</h4> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> memo<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'hello useEffect'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// useEffect 有两个参数</span>
  <span class="token comment">//第一个参数为回调函数</span>
  <span class="token comment">//  返回一个回调函数</span>
  <span class="token comment">//  监听事件时候卸载事件(避免浪费内存)</span>
  <span class="token comment">//第二个参数为数组类型</span>
  <span class="token comment">//  表示受谁的影响，如果变化那么就调用，如果为空数组，那么谁的影响都不受，只在渲染时调用一次</span>
  <span class="token comment">//  如果不传，那么不管谁变化都会触发回调</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'count 的 useEffect'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> count<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'message 的 useEffect'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'发送网络请求, 从服务器获取数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'会在组件被卸载时, 才会执行一次'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>message<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">count +1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hello lpz</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">变化</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>

</code></pre></div><h3 id="_4、usecontext"><a href="#_4、usecontext" class="header-anchor">#</a> 4、useContext</h3> <h4 id="_3-1-作用与使用-2"><a href="#_3-1-作用与使用-2" class="header-anchor">#</a> 3.1 作用与使用</h4> <h5 id="_3-1-1-作用-2"><a href="#_3-1-1-作用-2" class="header-anchor">#</a> 3.1.1 作用</h5> <ul><li>简便使用 <code>context</code></li></ul> <h5 id="_3-1-2-使用-2"><a href="#_3-1-2-使用-2" class="header-anchor">#</a> 3.1.2 使用</h5> <ul><li>每次context内容变化会重新调用渲染函数</li> <li>参数
<ul><li>传入一个context</li> <li>返回当前context的数据</li></ul></li></ul> <h4 id="_3-2-代码示例"><a href="#_3-2-代码示例" class="header-anchor">#</a> 3.2 代码示例</h4> <ul><li>context.js
<ul><li>先创建两个context</li></ul></li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> UserContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> ThemeContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><ul><li>index.js
<ul><li>在插入位置引入</li></ul></li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span><span class="token punctuation">;</span>

<span class="token comment">// import App from './01_不使用Hook/App';</span>
<span class="token comment">// import App from './02_计时器实现对比/App';</span>
<span class="token comment">// import App from './03_useState的使用/App';</span>
<span class="token comment">// import App from './04_useEffect的使用/App';</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./05_useContext的使用/App'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserContext<span class="token punctuation">,</span> ThemeContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./05_useContext的使用/context'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
    <span class="token comment">//插入context Provider 并设置值</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'lpz'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ThemeContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'red'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ThemeContext.Provider</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">UserContext.Provider</span></span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><ul><li>App.jsx
<ul><li>引入 <code>useContext</code> 并使用</li></ul></li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> memo<span class="token punctuation">,</span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserContext<span class="token punctuation">,</span> ThemeContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./context'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//useContext</span>
  <span class="token comment">//  每次context内容变化会重新调用渲染函数</span>
  <span class="token comment">//  传入一个context</span>
  <span class="token comment">//  返回当前context的数据</span>
  <span class="token comment">//</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>UserContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ThemeContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        UserContext-</span><span class="token punctuation">{</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token plain-text">-</span><span class="token punctuation">{</span>user<span class="token punctuation">.</span>age<span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> theme<span class="token punctuation">.</span>color <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">ThemeContext</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>

</code></pre></div><h3 id="_5、-usereducer-特殊情况usestate的替代品"><a href="#_5、-usereducer-特殊情况usestate的替代品" class="header-anchor">#</a> 5、 useReducer (特殊情况useState的替代品)</h3> <h4 id="_5-1-作用与使用"><a href="#_5-1-作用与使用" class="header-anchor">#</a> 5.1 作用与使用</h4> <h5 id="_5-1-1-作用"><a href="#_5-1-1-作用" class="header-anchor">#</a> 5.1.1 作用</h5> <ul><li><p>相当于 <code>useState</code> 需要的使用 <code>useReducer</code> 替换掉</p></li> <li><p>如果碰到复杂数据可以使用</p> <ul><li>最好优先使用 <code>redux</code> ,缺点看起来很乱</li></ul></li></ul> <h5 id="_5-1-2-使用"><a href="#_5-1-2-使用" class="header-anchor">#</a> 5.1.2 使用</h5> <ul><li>需要两个参数返回一个数组
<ul><li>参数
<ul><li>第一个参数为redeucer函数</li> <li>第二个为初始化state</li></ul></li> <li>返回值
<ul><li>第一个索引为state</li> <li>第二个为dispatch派发函数</li></ul></li></ul></li></ul> <h4 id="_5-2-代码示例"><a href="#_5-2-代码示例" class="header-anchor">#</a> 5.2 代码示例</h4> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> memo<span class="token punctuation">,</span> useReducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token comment">// import { useState } from 'react'</span>

<span class="token comment">// 适合用在数据复杂的时候</span>
<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'increment'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'decrement'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'add_number'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">+</span> action<span class="token punctuation">.</span>num <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'sub_number'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">-</span> action<span class="token punctuation">.</span>num <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// useReducer+Context =&gt; redux</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// const [count, setCount] = useState(0)</span>
  <span class="token comment">//useReducer</span>
  <span class="token comment">//  第一个参数为redeucer函数</span>
  <span class="token comment">//  第二个为初始化state</span>
  <span class="token comment">//返回值</span>
  <span class="token comment">//  返回一个数组</span>
  <span class="token comment">//    第一个索引为state</span>
  <span class="token comment">//    第二个为dispatch派发函数</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">friends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">//可以避免出现复杂类型需要多个定义useState </span>
  <span class="token comment">// const [counter, setCounter] = useState()</span>
  <span class="token comment">// const [friends, setFriends] = useState()</span>
  <span class="token comment">// const [user, setUser] = useState()</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">当前计数: </span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>counter<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'increment'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'decrement'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">-1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'add_number'</span><span class="token punctuation">,</span> <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+5</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'sub_number'</span><span class="token punctuation">,</span> <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">-5</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'add_number'</span><span class="token punctuation">,</span> <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+100</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>

</code></pre></div><h3 id="_6、-usecallback"><a href="#_6、-usecallback" class="header-anchor">#</a> 6、 useCallback</h3> <h4 id="_6-1-作用与使用"><a href="#_6-1-作用与使用" class="header-anchor">#</a> 6.1 作用与使用</h4> <h5 id="_6-1-1-作用"><a href="#_6-1-1-作用" class="header-anchor">#</a> 6.1.1 作用</h5> <ul><li><p><code>useCallback</code> 可以做性能优化</p> <ul><li>只有在给子组件传函数的时候才会有性能优化</li></ul> <blockquote><p>一个子组件在传入的props中如果是一个函数，父组件的render只要是调用子组件都会重新渲染，因为每次父组件渲染都会将传入的函数重新创建。</p> <p>而 useCallback 即做了优化，给<code>useCallback</code>一个依赖数组，那么只有数组中的依赖变化才会去让函数重新创建。</p></blockquote></li></ul> <h5 id="_6-1-2-使用"><a href="#_6-1-2-使用" class="header-anchor">#</a> 6.1.2 使用</h5> <ul><li>useCallback
<ul><li>参数
<ul><li>第一个参数是一个回调函数</li> <li>第二个参数是一个依赖数组</li></ul></li> <li>返回值
<ul><li>memoized (有记忆的函数)</li></ul></li></ul></li></ul> <h4 id="_6-2-usecallback-闭包陷阱-优化"><a href="#_6-2-usecallback-闭包陷阱-优化" class="header-anchor">#</a> 6.2 useCallback 闭包陷阱 优化</h4> <h5 id="_6-2-1-闭包陷阱的介绍"><a href="#_6-2-1-闭包陷阱的介绍" class="header-anchor">#</a> 6.2.1 闭包陷阱的介绍</h5> <blockquote><ul><li>在一个闭包函数被调用时，获取到一个函数变量每次调用都是第一次传入的值</li> <li>useCallback 如果不传入依赖的变量，那么每次调用都是第一次获取到的count值</li></ul></blockquote> <h5 id="_6-2-2-优化"><a href="#_6-2-2-优化" class="header-anchor">#</a> 6.2.2 优化</h5> <ul><li>可以使用 <code>useRef</code> 的 <code>current</code> 属性来当作需要依赖的值
<ul><li>因为 <code>useRef</code> 每次render调用时不会重新创建，但是<code>countRef.current</code>会去获取到最新的值</li> <li>这时即便是子组件依赖这个值，那么也不会重新渲染，</li> <li>因为<code>useRef</code> 没有变化 ，<code>shouldComponentUpdate</code>只是做了浅层比较，不同才会重新渲染</li></ul></li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code>  <span class="token comment">// 进一步的优化: 当count发生改变时, 也使用同一个函数(了解)</span>
  <span class="token comment">// 做法一: 将count依赖移除掉, 缺点: 闭包陷阱</span>
  <span class="token comment">// 做法二: useRef, 在组件多次渲染时, 返回的是同一个值</span>
  <span class="token keyword">const</span> countRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  countRef<span class="token punctuation">.</span>current <span class="token operator">=</span> count<span class="token punctuation">;</span>
  <span class="token keyword">const</span> increment <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>countRef<span class="token punctuation">.</span>current <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-3-代码示例"><a href="#_6-3-代码示例" class="header-anchor">#</a> 6.3 代码示例</h4> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> memo<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useCallback<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// useCallback</span>
<span class="token comment">//  第一个参数是一个回调函数</span>
<span class="token comment">//  第二个参数是一个依赖变量的数组</span>

<span class="token comment">// useCallback性能优化的点:</span>
<span class="token comment">//  1.当需要将一个函数传递给子组件时, 最好使用useCallback进行优化, 将优化之后的函数, 传递给子组件</span>
<span class="token comment">//    这么做的意义在于，如果不是跟子组件相关的数据变化，那么子组件不需要重新渲染</span>
<span class="token comment">//    普通函数每次都会创建一个新的函数，所以每次的子组件都会重新渲染</span>

<span class="token comment">// props中的属性发生改变时, 组件本身就会被重新渲染</span>
<span class="token keyword">const</span> Home <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> increment <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Home被渲染'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>increment<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">increment+1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span><span class="token comment">/* 100个子组件 */</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 闭包陷阱: useCallback</span>
  <span class="token comment">/**
   * 闭包陷阱的介绍
   *  在一个闭包函数被调用时，获取到一个函数变量每次调用都是第一次传入的值
   *  useCallback 如果不传入依赖的变量，那么每次调用都是第一次获取到的count值
   *
   */</span>

  <span class="token comment">//useCallback</span>
  <span class="token comment">//  只有count变化useCallback中的回调函数会变成一个新的函数</span>
  <span class="token comment">//  这个时候使用这个函数的子组件才会被重新渲染</span>
  <span class="token comment">// const increment = useCallback(</span>
  <span class="token comment">//   function foo() {</span>
  <span class="token comment">//     console.log('increment');</span>
  <span class="token comment">//     setCount(count + 1);</span>
  <span class="token comment">//   },</span>
  <span class="token comment">//   [count]</span>
  <span class="token comment">// );</span>

  <span class="token comment">// 进一步的优化: 当count发生改变时, 也使用同一个函数(了解)</span>
  <span class="token comment">// 做法一: 将count依赖移除掉, 缺点: 闭包陷阱</span>
  <span class="token comment">// 做法二: useRef, 在组件多次渲染时, 返回的是同一个值</span>
  <span class="token keyword">const</span> countRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  countRef<span class="token punctuation">.</span>current <span class="token operator">=</span> count<span class="token punctuation">;</span>
  <span class="token keyword">const</span> increment <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>countRef<span class="token punctuation">.</span>current <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 普通的函数</span>
  <span class="token comment">//  每次state变化,子组件都会重新渲染</span>
  <span class="token comment">// 因为每次都会创建一个新的increment函数</span>
  <span class="token comment">// const increment = () =&gt; {</span>
  <span class="token comment">//   setCount(count+1)</span>
  <span class="token comment">// }</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">计数: </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>increment<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Home</span></span> <span class="token attr-name">increment</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>increment<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">message:</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setMessage</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">修改message</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// function foo(name) {</span>
<span class="token comment">//   function bar() {</span>
<span class="token comment">//     console.log(name)</span>
<span class="token comment">//   }</span>
<span class="token comment">//   return bar</span>
<span class="token comment">// }</span>

<span class="token comment">// const bar1 = foo(&quot;lpz&quot;)</span>
<span class="token comment">// bar1() // lpz</span>
<span class="token comment">// bar1() // lpz</span>

<span class="token comment">// const bar2 = foo(&quot;kobe&quot;)</span>
<span class="token comment">// bar2() // kobe</span>

<span class="token comment">// bar1() // lpz</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>

</code></pre></div><h3 id="_7、-usememo"><a href="#_7、-usememo" class="header-anchor">#</a> 7、 useMemo</h3> <h4 id="_7-1-作用与使用"><a href="#_7-1-作用与使用" class="header-anchor">#</a> 7.1 作用与使用</h4> <h5 id="_7-1-1-作用"><a href="#_7-1-1-作用" class="header-anchor">#</a> 7.1.1 作用</h5> <ul><li>useMemo的作用与useCallback作用一致
<ul><li>处理子组件是否要渲染的性能优化</li></ul></li></ul> <h5 id="_7-1-2-使用"><a href="#_7-1-2-使用" class="header-anchor">#</a> 7.1.2 使用</h5> <ul><li>参数
<ul><li>第一个参数为回调函数
<ul><li>这个回调函数返回一个值</li></ul></li> <li>第二个参数为依赖数组</li></ul></li> <li>返回值
<ul><li>返回一个值</li></ul></li></ul> <h4 id="_7-2-代码示例"><a href="#_7-2-代码示例" class="header-anchor">#</a> 7.2 代码示例</h4> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> memo<span class="token punctuation">,</span> useCallback <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useMemo<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> HelloWorld <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'HelloWorld被渲染~'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Hello World</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//useMemo</span>
<span class="token comment">//  第一个参数为回调函数</span>
<span class="token comment">//    这个回调函数返回一个值</span>
<span class="token comment">//  第二个参数为依赖数组</span>
<span class="token comment">//  返回值</span>
<span class="token comment">//      返回一个值</span>

<span class="token keyword">function</span> <span class="token function">calcNumTotal</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log(&quot;calcNumTotal的计算过程被调用~&quot;)</span>
  <span class="token keyword">let</span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> num<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    total <span class="token operator">+=</span> i<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> total<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// const result = calcNumTotal(50)</span>

  <span class="token comment">// 1.不依赖任何的值, 进行计算</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">calcNumTotal</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 2.依赖count</span>
  <span class="token comment">// const result = useMemo(() =&gt; {</span>
  <span class="token comment">//   return calcNumTotal(count*2)</span>
  <span class="token comment">// }, [count])</span>

  <span class="token comment">// 3.useMemo和useCallback的对比</span>
  <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token comment">// const increment = useCallback(fn, [])</span>
  <span class="token comment">// const increment2 = useMemo(() =&gt; fn, [])</span>

  <span class="token comment">// 4.使用useMemo对子组件渲染进行优化</span>
  <span class="token comment">// const info = { name: &quot;why&quot;, age: 18 }</span>
  <span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'why'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">计算结果: </span><span class="token punctuation">{</span>result<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">计数器: </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">

      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HelloWorld</span></span> <span class="token attr-name">result</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>result<span class="token punctuation">}</span></span> <span class="token attr-name">info</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>info<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>

</code></pre></div><h3 id="_8、useref"><a href="#_8、useref" class="header-anchor">#</a> 8、useRef</h3> <h4 id="_8-1-作用与使用"><a href="#_8-1-作用与使用" class="header-anchor">#</a> 8.1 作用与使用</h4> <h5 id="_8-1-1-作用"><a href="#_8-1-1-作用" class="header-anchor">#</a> 8.1.1 作用</h5> <ul><li>可以获取到dom元素</li> <li>可以给<code>useCallback</code> 做避免<code>闭包陷阱</code>的出现
<ul><li>因为 <code>useRef</code> 不会每次 render时候都创建一个新的会保存在内存中</li></ul></li></ul> <h5 id="_8-1-2-使用"><a href="#_8-1-2-使用" class="header-anchor">#</a> 8.1.2 使用</h5> <ul><li>调用<code>useRef</code>函数
<ul><li>返回一个实例</li></ul></li></ul> <h4 id="_8-2-代码示例"><a href="#_8-2-代码示例" class="header-anchor">#</a> 8.2 代码示例</h4> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> memo<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useCallback <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> nameRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj <span class="token operator">===</span> nameRef<span class="token punctuation">)</span><span class="token punctuation">;</span>
  obj <span class="token operator">=</span> nameRef<span class="token punctuation">;</span>

  <span class="token comment">// 通过useRef解决闭包陷阱</span>
  <span class="token keyword">const</span> countRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  countRef<span class="token punctuation">.</span>current <span class="token operator">=</span> count<span class="token punctuation">;</span>

  <span class="token keyword">const</span> increment <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>countRef<span class="token punctuation">.</span>current <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Hello World: </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>increment<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>

</code></pre></div><h3 id="_9、useimperativehandle"><a href="#_9、useimperativehandle" class="header-anchor">#</a> 9、useImperativeHandle</h3> <h4 id="_9-1-作用与使用"><a href="#_9-1-作用与使用" class="header-anchor">#</a> 9.1 作用与使用</h4> <h5 id="_9-1-1-作用"><a href="#_9-1-1-作用" class="header-anchor">#</a> 9.1.1  作用</h5> <ul><li>对父组件的ref做安全处理,允许访问的一些操作,使用其他不生效</li> <li>useImperativeHandle 返回的对象会绑定在 父组件ref中的current中</li></ul> <h5 id="_9-1-2-使用"><a href="#_9-1-2-使用" class="header-anchor">#</a> 9.1.2 使用</h5> <ul><li>参数
<ul><li>第一个参数为父组件传入的<code>ref</code></li> <li>第二个参数为一个函数，返回一个对象，绑定在父组件的 <code>useRef.current</code>上。</li></ul></li></ul> <h4 id="_9-2-代码示例"><a href="#_9-2-代码示例" class="header-anchor">#</a> 9.2 代码示例</h4> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> memo<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> forwardRef<span class="token punctuation">,</span> useImperativeHandle <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// 因为是函数组件没有实例,所以需要forwardRef包裹返回</span>
<span class="token keyword">const</span> HelloWorld <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span>
  <span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//子组件内部自己定义一个ref,父组件操作时拦截使用自己的ref做操作</span>

    <span class="token comment">// 子组件对父组件传入的ref进行处理</span>
    <span class="token comment">// 对父组件的ref做安全处理,允许访问的一些操作,使用其他不生效</span>
    <span class="token comment">// useImperativeHandle 返回的对象会绑定在 父组件ref中的current中</span>
    <span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'focus'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>inputRef<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> titleRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleDOM</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.log(inputRef.current)</span>
    inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// inputRef.current.value = &quot;&quot;</span>
    inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">'哈哈哈'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>titleRef<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">哈哈哈</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HelloWorld</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>inputRef<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleDOM<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">DOM操作</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>

</code></pre></div><h3 id="_10、uselayouteffect"><a href="#_10、uselayouteffect" class="header-anchor">#</a> 10、useLayoutEffect</h3> <h4 id="_10-1-作用与使用"><a href="#_10-1-作用与使用" class="header-anchor">#</a> 10.1 作用与使用</h4> <h5 id="_10-1-1-作用"><a href="#_10-1-1-作用" class="header-anchor">#</a> 10.1.1 作用</h5> <blockquote><p>可以应用于页面某个元素等于一个值的时候不在DOM中显示，监听拦截</p></blockquote> <ul><li>与 useEffect 类似</li> <li>区别在于
<ul><li><code>useEffect</code> 等待DOM渲染完成再去执行，不会阻塞DOM更新</li> <li><code>useEffect</code> 先执行后DOM渲染，会阻塞DOM更新</li></ul></li></ul> <h5 id="_10-1-2-使用"><a href="#_10-1-2-使用" class="header-anchor">#</a> 10.1.2 使用</h5> <ul><li>参数
<ul><li>第一参数为回调函数</li> <li>第二个参数为依赖数组</li></ul></li></ul> <h4 id="_10-2-代码示例"><a href="#_10-2-代码示例" class="header-anchor">#</a> 10.2 代码示例</h4> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> memo<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useLayoutEffect<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//useEffect 因为时在渲染DOM后执行,所以设置为0时候会闪烁一下,先0后随机数</span>

  <span class="token comment">// useEffect(() =&gt; {</span>
  <span class="token comment">//   console.log('useEffect');</span>
  <span class="token comment">//   if (count === 0) {</span>
  <span class="token comment">//     setCount(Math.random() + 99);</span>
  <span class="token comment">//   }</span>
  <span class="token comment">// });</span>

  <span class="token comment">//useLayoutEffect 不会出现闪烁,在发现是0时候,及时阻塞DOM重新渲染</span>

  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'useLayoutEffect'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setCount</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'App render'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">count: </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">设置为0</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>

</code></pre></div><h2 id="二、自定义hooks"><a href="#二、自定义hooks" class="header-anchor">#</a> 二、自定义hooks</h2> <h3 id="_1、设置本地localstorage"><a href="#_1、设置本地localstorage" class="header-anchor">#</a> 1、设置本地localStorage</h3> <h4 id="_1-1-代码示例"><a href="#_1-1-代码示例" class="header-anchor">#</a> 1.1 代码示例</h4> <ul><li>App.jsx</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> memo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useLocalStorage <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./hooks'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'App函数组件加载'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>token<span class="token punctuation">,</span> setToken<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useLocalStorage</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useLocalStorage</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">token:</span><span class="token punctuation">{</span>token<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">message:</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setToken</span><span class="token punctuation">(</span><span class="token string">'加入token'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">设置token</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">'hello 自定义hooks'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">设置name</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>

</code></pre></div><ul><li>useLocalStorage.js
<ul><li>hook</li></ul></li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">useLocalStorage</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 设置初始值,没有值即为空</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> item <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>item<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//   监听data变化,变化即调用回调渲染页面</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>data<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> useLocalStorage<span class="token punctuation">;</span>
</code></pre></div><h2 id="三、-redux-中的hooks"><a href="#三、-redux-中的hooks" class="header-anchor">#</a> 三、 redux 中的hooks</h2> <h3 id="_1、useselector"><a href="#_1、useselector" class="header-anchor">#</a> 1、useSelector</h3> <h4 id="_1-1-作用与使用"><a href="#_1-1-作用与使用" class="header-anchor">#</a> 1.1 作用与使用</h4> <ul><li>获取 redux 中的state</li></ul> <h4 id="_1-2-使用与性能"><a href="#_1-2-使用与性能" class="header-anchor">#</a> 1.2 使用与性能 *</h4> <ul><li><p>第一个参数 是一个函数</p> <ul><li>这个函数的第一个参数是state</li> <li>返回一个使用的state对象</li></ul></li> <li><p>第二个参数为浅层比较</p></li> <li><p>只有使用到的值变化了，才会去渲染组件</p></li> <li><p>如果不传入第二个参数，那么每次 <code>useSelector</code> store 数据有变化，都会重新渲染会影响性能</p></li></ul> <h3 id="_2、usedispatch"><a href="#_2、usedispatch" class="header-anchor">#</a> 2、useDispatch</h3> <h4 id="_2-1-作用与使用-2"><a href="#_2-1-作用与使用-2" class="header-anchor">#</a> 2.1 作用与使用</h4> <ul><li>获取 <code>dispatch</code>派发函数</li></ul> <h4 id="_2-2-使用"><a href="#_2-2-使用" class="header-anchor">#</a> 2.2 使用</h4> <ul><li>调用 <code>useDispatch</code>返回一个<code>dispatch</code> 函数</li></ul> <h3 id="_3、shallowequal"><a href="#_3、shallowequal" class="header-anchor">#</a> 3、shallowEqual</h3> <h4 id="_3-1-作用与使用-3"><a href="#_3-1-作用与使用-3" class="header-anchor">#</a> 3.1 作用与使用</h4> <ul><li>做浅层比较
<ul><li>作为 <code>useSelector</code> 的第二个参数</li></ul></li></ul> <h3 id="_1-2-3-代码示例"><a href="#_1-2-3-代码示例" class="header-anchor">#</a> 1.2.3 代码示例</h3> <ul><li>store/index.js</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> configureStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@reduxjs/toolkit'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> counterReducer <span class="token keyword">from</span> <span class="token string">'./modules/counter'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">configureStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">reducer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">counter</span><span class="token operator">:</span> counterReducer<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>

</code></pre></div><ul><li>counter.js</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createSlice <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@reduxjs/toolkit'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> counterSlice <span class="token operator">=</span> <span class="token function">createSlice</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'counter'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">initialState</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">99</span><span class="token punctuation">,</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'Hello World'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">reducers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">addNumberAction</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>count <span class="token operator">=</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> payload<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">subNumberAction</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>count <span class="token operator">=</span> state<span class="token punctuation">.</span>count <span class="token operator">-</span> payload<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function">changeMessageAction</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
      state<span class="token punctuation">.</span>message <span class="token operator">=</span> payload<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> addNumberAction<span class="token punctuation">,</span> subNumberAction<span class="token punctuation">,</span> changeMessageAction <span class="token punctuation">}</span> <span class="token operator">=</span> counterSlice<span class="token punctuation">.</span>actions<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> counterSlice<span class="token punctuation">.</span>reducer<span class="token punctuation">;</span>

</code></pre></div><ul><li>App.jsx</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> memo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useDispatch<span class="token punctuation">,</span> useSelector<span class="token punctuation">,</span> shallowEqual <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> changeMessageAction<span class="token punctuation">,</span> addNumberAction<span class="token punctuation">,</span> subNumberAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./store/modules/counter'</span><span class="token punctuation">;</span>

<span class="token comment">// memo高阶组件包裹起来的组件有对应的特点: 只有props发生改变时, 才会重新渲染</span>
<span class="token comment">// useSelector 缺点</span>
<span class="token comment">//  只要useSelector 里边不管什么变化，即便是没有使用到 props 都会变化，memo就会重新渲染组件</span>
<span class="token comment">//  useSelector 第二个参数 传入 shallowEqual 做浅层比较，只有使用到的值有变化再会渲染，此问题就会解决</span>
<span class="token keyword">const</span> Home <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//useSelector 获取 redux 中的state</span>
  <span class="token comment">//  第一个参数 是一个函数</span>
  <span class="token comment">//    第一个参数是state</span>
  <span class="token comment">//    返回一个使用的state对象</span>
  <span class="token comment">//  第二个参数为浅层比较</span>
  <span class="token comment">//    只有使用到的值变化了，才会去渲染组件</span>

  <span class="token keyword">const</span> <span class="token punctuation">{</span> message <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    shallowEqual
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">changeMessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">changeMessageAction</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Home 渲染'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Home:</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">changeMessage</span><span class="token punctuation">(</span><span class="token string">'Hello Redux Hook'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">变化message</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'App 渲染'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//useSelector 获取状态</span>
  <span class="token comment">//  第一个参数为函数返回需要的state</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> coute <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">coute</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter<span class="token punctuation">.</span>count <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> shallowEqual<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// redux hook useDispatch 直接获取dispatch</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">addNumber</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addNumberAction</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">subNumber</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">subNumberAction</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">App:</span><span class="token punctuation">{</span>coute<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">addNumber</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">subNumber</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">-2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Home</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>

</code></pre></div><h2 id="四、ssr与spa"><a href="#四、ssr与spa" class="header-anchor">#</a> 四、SSR与SPA</h2> <h3 id="_1、spa单页面富应用的两个缺点"><a href="#_1、spa单页面富应用的两个缺点" class="header-anchor">#</a> 1、SPA单页面富应用的两个缺点</h3> <ul><li><p>首屏渲染速度</p> <ul><li>需要下载 js 才会渲染页面</li></ul></li> <li><p>SEO的优化</p> <blockquote><p>例如：</p> <ul><li>百度爬虫只会爬取 index.html 但是SPA页面的index.htm只有一个div 、meta、title一些东西，搜索的关键字很少就会导致网站流量不行</li> <li>但是谷歌搜索引擎是会下载代码，做一个深入的seo</li></ul></blockquote></li></ul> <h3 id="_2、ssr"><a href="#_2、ssr" class="header-anchor">#</a> 2、SSR</h3> <h4 id="_2-1-定义"><a href="#_2-1-定义" class="header-anchor">#</a> 2.1 定义</h4> <blockquote><ul><li><p>SSR（<strong>Server Side Rendering，服务端渲染</strong>），指的是页面在服务器端已经生成了完成的HTML页面结构，不需要浏览器执行代码，创建页面结构</p></li> <li><p>对应的是CSR（<strong>Client Side Rendering，客户端渲染</strong>），</p> <p>我们开发的SPA页面通常依赖的就是客户端渲染；</p></li></ul></blockquote> <ul><li><strong>我们可以借助于Node来帮助我们执行JavaScript代码，提前完成页面的渲染</strong></li></ul> <h3 id="_3、ssr同构应用"><a href="#_3、ssr同构应用" class="header-anchor">#</a> 3、SSR同构应用</h3> <h4 id="_3-1-定义"><a href="#_3-1-定义" class="header-anchor">#</a> 3.1 定义</h4> <blockquote><p>一套代码既可以在服务端运行又可以在客户端运行，这就是同构应用。</p></blockquote> <ul><li>当用户发出请求时，先在服务器通过SSR渲染出首页的内容。</li> <li>但是对应的代码同样可以在客户端被执行。</li> <li>执行的目的包括事件绑定等以及其他页面切换时也可以在客户端被渲染；</li></ul> <h3 id="_4、hydration"><a href="#_4、hydration" class="header-anchor">#</a> 4、Hydration</h3> <h4 id="_4-1定义"><a href="#_4-1定义" class="header-anchor">#</a> 4.1定义</h4> <ul><li>在进行<code>ssr</code>时候页面的 html 只是一堆字符串而已
<ul><li>并没有js交互行为，函数什么的都调用不了</li></ul></li> <li>在第一次 node 将也买你呈现为 html 外，客户端一些框架在页面加载和呈现中<code>注入</code> js交互性，在浏览器中在执行一次
<ul><li><strong>这个注入的过程就叫做 Hydration</strong></li></ul></li></ul> <h2 id="五、useid"><a href="#五、useid" class="header-anchor">#</a> 五、useId</h2> <h3 id="_1、作用与使用"><a href="#_1、作用与使用" class="header-anchor">#</a> 1、作用与使用</h3> <h4 id="_1-1-作用"><a href="#_1-1-作用" class="header-anchor">#</a> 1.1 作用</h4> <ul><li><p>在SSR同构应用中，客户端与服务端渲染可能会出现某个ID不同导致一些问题</p></li> <li><p>例:</p> <blockquote><p>一个div在服务端渲染 ID 是aa 而在客户端就是 bb，这个时候js如果根据id获取就会出现问题</p></blockquote> <ul><li>useId 可以在客户端渲染和服务端渲染中使用一个相同的id，就不会出现以上情况</li></ul></li></ul> <h4 id="_1-2-使用"><a href="#_1-2-使用" class="header-anchor">#</a> 1.2 使用</h4> <ul><li>调用 <code>useId</code>函数返回一个 id</li></ul> <h3 id="_2、代码示例"><a href="#_2、代码示例" class="header-anchor">#</a> 2、代码示例</h3> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> memo<span class="token punctuation">,</span> useId<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">useId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">count+1:</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">

      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">htmlFor</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        用户名:</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App

</code></pre></div><h2 id="六、usetransition"><a href="#六、usetransition" class="header-anchor">#</a> 六、useTransition</h2> <h3 id="_1、作用与使用-2"><a href="#_1、作用与使用-2" class="header-anchor">#</a> 1、作用与使用</h3> <h4 id="_1-1-作用-2"><a href="#_1-1-作用-2" class="header-anchor">#</a> 1.1 作用</h4> <ul><li>返回一个状态值表示过渡任务的等待状态，以及一个启动该过渡任务的函数。</li></ul> <h4 id="_1-2-使用-2"><a href="#_1-2-使用-2" class="header-anchor">#</a> 1.2 使用</h4> <ul><li>调用 <code>useTransition</code> 函数
<ul><li>返回数组 有两个值
<ul><li>第一个为 Boolean 是否加载完成</li> <li>第二个 函数 过渡任务执行</li></ul></li></ul></li></ul> <h3 id="_2、代码示例-2"><a href="#_2、代码示例-2" class="header-anchor">#</a> 2、代码示例</h3> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> memo<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useTransition <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> namesArray <span class="token keyword">from</span> <span class="token string">'./namesArray'</span><span class="token comment">//数组随机数</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>showNames<span class="token punctuation">,</span> setShowNames<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>namesArray<span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span> pending<span class="token punctuation">,</span> startTransition <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useTransition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">function</span> <span class="token function">valueChangeHandle</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">startTransition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> keyword <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
      <span class="token keyword">const</span> filterShowNames <span class="token operator">=</span> namesArray<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>keyword<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token function">setShowNames</span><span class="token punctuation">(</span>filterShowNames<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onInput</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>valueChangeHandle<span class="token punctuation">}</span></span><span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">用户名列表: </span><span class="token punctuation">{</span>pending <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">data loading</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">}</span><span class="token plain-text"> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>
          showNames<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App

</code></pre></div><h2 id="七、usedeferredvalue"><a href="#七、usedeferredvalue" class="header-anchor">#</a> 七、useDeferredValue</h2> <h3 id="_1、作用与使用-3"><a href="#_1、作用与使用-3" class="header-anchor">#</a> 1、作用与使用</h3> <h4 id="_1-1-作用-3"><a href="#_1-1-作用-3" class="header-anchor">#</a> 1.1 作用</h4> <ul><li>useDeferredValue 接受一个值，并返回该值的新副本，该副本将推迟到更紧急地更新之后</li></ul> <h4 id="_1-2-使用-3"><a href="#_1-2-使用-3" class="header-anchor">#</a> 1.2 使用</h4> <h3 id="_2、代码示例-3"><a href="#_2、代码示例-3" class="header-anchor">#</a> 2、代码示例</h3> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> memo<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useDeferredValue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> namesArray <span class="token keyword">from</span> <span class="token string">'./namesArray'</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>showNames<span class="token punctuation">,</span> setShowNames<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>namesArray<span class="token punctuation">)</span>
  <span class="token keyword">const</span> deferedShowNames <span class="token operator">=</span> <span class="token function">useDeferredValue</span><span class="token punctuation">(</span>showNames<span class="token punctuation">)</span>

  <span class="token keyword">function</span> <span class="token function">valueChangeHandle</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> keyword <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
    <span class="token keyword">const</span> filterShowNames <span class="token operator">=</span> namesArray<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>keyword<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">setShowNames</span><span class="token punctuation">(</span>filterShowNames<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onInput</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>valueChangeHandle<span class="token punctuation">}</span></span><span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">用户名列表: </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>
          deferedShowNames<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App

</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/Pz-blog/assets/js/app.6f56e517.js" defer></script><script src="/Pz-blog/assets/js/2.9b71ad29.js" defer></script><script src="/Pz-blog/assets/js/14.8b0dca08.js" defer></script>
  </body>
</html>
